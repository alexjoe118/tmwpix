<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>TMWPIX</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="TMWPIX" name="description" />
    <meta content="" name="keywords" />
    <meta content="" name="author" />
    <!-- CSS Files
    ================================================== -->
    <link id="bootstrap" href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link id="font" href="fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
</head>

<body style="background: #000;" class="">

    <div id="channel-container" class="vh-100 d-flex flex-column" class="">
        <!-- header begin -->
        <!-- <header class="w-100">
            <div class="p-3 d-flex align-items-center justify-content-between">
                <div class="back_btn_container d-flex justify-content-start">
                    <a href="#" onclick="" class="back_btn"><i class="fa fa-3x fa-angle-left"></i></a>
                </div>

                <a href="#">
                    <img src="./img/logotmwpix.png" width="200" height="50" class="logo-img">
                </a>

            </div>
        </header> -->
        <!-- header close -->
        <!-- content begin -->
        <div class="transparent_view"></div>
<!-- <<<<<<< HEAD -->

      
        <video class="channel_src"  disablePictureInPicture controlslist=" nofullscreen nodownload noremoteplayback noplaybackrate foobar">
            <source src="https://www.w3schools.com/html/mov_bbb.mp4
            " >
        </video>
        <div class="channel_controller d-flex d-none align-items-center justify-content-between"
            onclick="showChannel()">
            <div class="d-flex align-items-center">
                <div
                    class="d-flex flex-column justify-content-center align-items-center text-center channel_name_container">


        
        <!-- <video controls >
            <source src="https://www.w3schools.com/html/mov_bbb.mp4
            " type="video/mp4">
        </video>
        <div class="channel_controller d-flex d-none align-items-center justify-content-between" >
            <div class="d-flex align-items-center">
                <div class="d-flex flex-column justify-content-center align-items-center text-center channel_name_container"> -->
<!-- >>>>>>> e1622ab1cb87039fe98eb5f7e1e7a800447d9288 -->

                    <div class="channel_number">
                        1
                    </div>
                    <div class="channel_name">
                        SBT RS HD
                    </div>
                </div>
                <div class="text-white ps-4 fs-5">
                    Atual: <span class="agoratitulo"></span><br>
                    Próximo: <span class="depoistitulo"></span>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <div class="d-flex align-items-center text-white fs-5 px-3">
                    <i class="fa fa-file-video-o mx-3"></i>

<i class="fa fa-info-circle mx-3" data-bs-toggle="modal"
data-bs-target="#channel_description"></i>
<i class="fa fa-music mx-3" data-bs-toggle="modal"
data-bs-target="#channel_audio"></i>

                </div>

                <div class="d-flex flex-column justify-content-center align-items-center text-white px-3">
                    <img class="active_channel_img" src="./img/0.png">
                    <div class="active_channel_agorag mt-1">
                        <!-- 06:00 - 11:40 -->
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
            </div>
        </div>
        <div class="channel-content flex-grow-1 pt-2 px-1 d-none position-absolute top-0">
            <div class="channel-list d-flex flex-wrap flex-items-center">
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        51
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        41
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        31
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        21
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        11
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        18
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        19
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        16
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        15
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        14
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        13
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
                <div class="channel-list-item d-flex justify-content-between align-items-center px-4">
                    <img class="channel-list-item-img" src="./img/0.png">
                    <div class="channel-list-item-number">
                        12
                        <!-- {nowPlaying.agorastart} - {nowPlaying.agorastop} -->
                    </div>
                </div>
            </div>

        </div>
        <div class="modal fade" id="channel_audio" tabindex="-1" aria-labelledby="Controle Remoto" aria-hidden="true">
            <div class="modal-dialog custom_modal">
                <div class="modal-content">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-white">Selecionar áudio</div>
                        <div class="close_modal" data-bs-dismiss="modal" aria-label="Close">X Fechar</div>
                    </div>
                    <div class="d-flex flex-column text-start mt-2">
                        <div class="audio_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                        <div class="audio_modal_item">
                            {item.idioma} <span class="selected">-Selecionado</span>
                        </div>
                        <div class="audio_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                        <div class="audio_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="channel_description" tabindex="-1" aria-labelledby="Controle Remoto"
            aria-hidden="true">
            <div class="modal-dialog custom_modal">
                <div class="modal-content">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-white">Descrição EPG</div>
                        <div class="close_modal" data-bs-dismiss="modal" aria-label="Close">X Fechar</div>
                    </div>
                    <div class="text-start text-white mt-2 channel_description_content">
                        {nowPlaying.descricao}
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="channel_resolution" tabindex="-1" aria-labelledby="Controle Remoto"
            aria-hidden="true">
            <div class="modal-dialog custom_modal">
                <div class="modal-content">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-white">Selecionar resolução</div>
                        <div class="close_modal" data-bs-dismiss="modal" aria-label="Close">X Fechar</div>
                    </div>
                    <div class="d-flex flex-column text-start mt-2">
                        <div class="resolution_modal_item">
                            {item.resolution} <span class="selected"></span>
                        </div>
                        <div class="resolution_modal_item">
                            {item.resolution} <span class="selected">-Selecionado</span>
                        </div>
                        <div class="resolution_modal_item">
                            {item.resolution} <span class="selected"></span>
                        </div>
                        <div class="resolution_modal_item">
                            {item.resolution} <span class="selected"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="channel_legend" tabindex="-1" aria-labelledby="Controle Remoto" aria-hidden="true">
            <div class="modal-dialog custom_modal">
                <div class="modal-content">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-white">Selecionar legenda</div>
                        <div class="close_modal" data-bs-dismiss="modal" aria-label="Close">X Fechar</div>
                    </div>
                    <div class="d-flex flex-column text-start mt-2">
                        <div class="legend_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                        <div class="legend_modal_item">
                            {item.idioma} <span class="selected">-Selecionado</span>
                        </div>
                        <div class="legend_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                        <div class="legend_modal_item">
                            {item.idioma} <span class="selected"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Javascript Files
    ================================================== -->
    <script src="js/plugins.js"></script>

    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const channelId = urlParams.get('channelId');
        const userToken = JSON.parse(window.localStorage.getItem('LOGGED_USR'));
        if (userToken == null) {
            window.location.href = "./login.html";
        }
        var channels = {};
        var curIndex = -1;
        var link = `http://api.tmwpix.com/channels3?user=${userToken.usr}&time=${userToken.time}&hash=${userToken.hash}&dtoken=${userToken.pass}&os=android&operator=1&tipo=${userToken.loginType}&usrtoken=${userToken.usrtoken}&hashtoken=${userToken.hashtoken}`;
        $.ajax({
            url: link,
            type: 'GET',
            dataType: 'json',
            success: function (result) {
                if (result.hasOwnProperty('error')) {
                    alert(result['error']['message']);
                } else {
                    console.log("channel", result);
                    channels = result.channels;
                    var html = "";
                    for (i = 0; i < channels.length; i++) {
                        html += `<div class="channel-list-item d-flex justify-content-between align-items-center px-4" onclick="OnChannel(${i})">`
                            + `<img class="channel-list-item-img" src="${channels[i].image}"><div class="channel-list-item-number">${channels[i].number}</div></div>`;
                    }
                    $(".channel-list").html(html);
                    if(channelId == undefined){
                        OnChannel(0);
                        console.log("from egp page", channelId);
                    }else{
                        channels.filter((channel, index) => {if (channel.id == channelId){
                            OnChannel(index);
                        }});
                        console.log("from egp index", channelId);
                    }
                    


                }
            },
            error: function (xhr, status, error) {
                alert(`Error ${error}`);
            },

        });
        function OnChannel(index) {
            $(".channel_src").attr("src", channels[index].url);
            $('.channel-content').toggleClass('d-none');
            $('.channel_controller').toggleClass('d-none');

            $(".channel_name").html(channels[index].name);
            $(".channel_number").html(channels[index].number);
            var link1 = `http://api.tmwpix.com/channels/nowplaying?id=${channels[index].id ? channels[index].id : '1'
                }`;

            if (userToken !== undefined && userToken.profile !== undefined) {
                link1 = `http://api.tmwpix.com/channels/nowplaying?id=${channels[index].id ? channels[index].id : '1'
                    }&perfis_id=${userToken.profile.id}&user=${userToken.usr}&time=${userToken.time
                    }&hash=${userToken.hash}&dtoken=${userToken.pass
                    }&os=android&operator=1&tipo=${userToken.loginType}&usrtoken=${userToken.usrtoken
                    }&hashtoken=${userToken.hashtoken}&page=tv`;
            }
            $(".active_channel_img").attr("src", channels[index].image);
            $.ajax({
                url: link1,
                type: 'GET',
                dataType: 'json',
                success: function (result) {
                    if (result.hasOwnProperty('error')) {
                        alert(result['error']['message']);
                    } else {
                        console.log("channel_onde", result);
                        if(result.prog.length > 0){
                            $(".agoratitulo").html(result.prog[0].agoratitulo);
                            $(".depoistitulo").html(result.prog[0].depoistitulo);
                            $(".active_channel_agorag").html(`${result.prog[0].agorastart} - ${result.prog[0].agorastop}`)
                        }
                        

                    }
                },
                error: function (xhr, status, error) {
                    alert(`Error ${error}`);
                },

            });
        }

        function showChannel() {
            $('.channel-content').toggleClass('d-none')
            $('.channel_controller').toggleClass('d-none')
        }
        $(document).ready(function () { // better to use $(document).ready(function(){
            $('video').on('click touchstart', function () {
                showChannel()
            });
        });
    </script>

</body>

</html>